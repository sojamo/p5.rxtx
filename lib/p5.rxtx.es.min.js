const e=(r,t)=>{for(const o in t)t[o]&&"object"==typeof t[o]&&!Array.isArray(t[o])?r[o]=e(r[o]||{},t[o]):r[o]=t[o];return r},r=(e,r)=>{Object.assign(e,r)},t=(e,t)=>{if(!e.includes("\n"))return void(t.readBuffer+=e);const[o,a]=e.split("\n");t.readBuffer+=o,(async e=>{try{return JSON.parse(e)}catch(e){return{id:-1,value:[],type:"error"}}})(t.readBuffer).then((e=>{if(void 0!==e.value){const{id:o,value:a}=e;t.debug.data={value:a,id:o},r(t,{value:a||[],id:o||-1}),t.fn({id:t.id,value:t.value}),t.rxtxEvent({id:t.id,value:t.value})}t.readBuffer=a||""})).catch((e=>console.log("Error parsing data:",e)))},o=async()=>{if(!("serial"in navigator))throw new Error("Web Serial API not supported.");return await navigator.serial.getPorts()},a=async()=>{try{return await navigator.serial.requestPort()}catch(e){return void console.log("Error selecting port:",e)}},n=async(e,t)=>{if(!e)return console.log("No port provided."),!1;try{await e.open({baudRate:t.baudRate});const o=new TextDecoderStream,a=(e.readable.pipeTo(o.writable),o.readable.getReader()),n=e.writable.getWriter();t.connectedPorts.push({thePort:e,reader:a,writer:n}),console.log("Serial communication established with",e.getInfo()),r(t,{connected:!0,port:e,reader:a,writer:n,io:!0})}catch(o){throw console.log("Error connecting to port:",o),l(e,t).then((()=>console.log("Resources cleaned up."))).catch(console.error),r(t,{connected:!1,port:e,reader:null,writer:null,io:!1}),new Error("Failed to connect")}return await s(t),!1},s=async e=>{try{for(;e.connected;){const{value:r,done:o}=await e.reader.read();if(o)break;r&&t(r,e)}}catch(e){throw console.log("Error during read:",e),e}finally{l(e.port,e).then((()=>console.log("Resources cleaned up."))).catch(console.error)}},l=async(e,r)=>{try{r.reader&&(await r.reader.cancel(),r.reader.releaseLock()),r.writer&&(await r.writer.close(),r.writer.releaseLock())}catch(e){console.log("Error during cleanup:",e)}},c=async e=>{if(0===(await o()).length)console.log("No previously granted ports detected, add connect button."),await i(e);else{console.log("Previously granted ports detected, wait to reconnect ..");try{await(async e=>{const r=await o();console.log("trying to reconnect to previous port(s)",r);for(const t of r)await n(t,e)})(e)}catch(r){console.log("couldn't reconnect to previously granted port(s)."),await i(e,!1)}}return e},i=async(e,r=!0)=>{const t=r?["#03a1ff","#06b004"]:["#ffa103","#666666"],s=createButton(r?"connect":"unavailable");s.position(20,20),s.style(`\n    background: ${t[0]};\n    color: #fff;\n    font-size: 16px;\n    margin: auto;\n    border: 0;\n    padding: 8px 32px;\n    border-radius: 32px;\n    transition: background 0.3s;\n  `),s.mouseOver((()=>s.style(`background: ${t[1]};`))),s.mouseOut((()=>s.style(`background: ${t[0]};`))),s.mousePressed((async()=>{e.fn=e=>{console.log("debug: "+e)};try{const r=await(async e=>{e.readBuffer="";const r=await o();let t;return t=0===r.length?await a():r.length>0?r[0]:null,await n(t,e)})(e);console.log(r),r&&s.remove()}catch(e){console.log(e.message)}}))};document.ontouchmove=e=>{e.preventDefault()};const d=e=>{if(!0===isKeyPressed){if(!1===e.isKeyPressed){if(e.isKeyPressed=!0,!e.mappedKeys.includes(key))return;switch(key){case"d":e.debug.show=!e.debug.show;break;case"f":fullscreen()||fullscreen(!0);break;case"p":e.debug.print=!e.debug.print;break;case"s":const r=`${e.image.label}_${(()=>{let e=year()+nf(month(),2)+nf(day(),2);return e+=nf(hour(),2)+nf(minute(),2)+nf(second(),2),e})()}.${e.image.format}`;console.log(`saving image ${r}`),saveCanvas(r,e.image.format);break;case"v":console.log("p5.rxtx 0.1.1 by sojamo")}}}else e.isKeyPressed=!1},u={},g=async(t,o={})=>{((t,o,a)=>{const n={debug:{data:{}},connected:!1,io:null,isKeyPressed:!1,rxtxEvent:t.rxtxEvent||(e=>{}),readBuffer:"",connectedPorts:[]};r(a,e(e({baudRate:57600,id:-1,value:[],fn:e=>{},image:{label:"rxtx",format:"jpg"},mappedKeys:["d","f","p","s","v"],debug:{print:!1,show:!1}},o),n)),c(a)})(t,o,u)},p=()=>null!=u.debug.data.value,f=()=>u.connected,b=()=>null!=u.io,y=e=>{const r=w();return e>=r.length?-1:r[e]},w=()=>u.value||[];var h,v,m;h=window,v=u,(m=h).p5?(m.p5.prototype.windowResized=()=>{resizeCanvas(windowWidth,windowHeight)},m.p5.prototype.registerMethod("post",(()=>d(v))),m.p5.prototype.registerMethod("post",(()=>(e=>{if(void 0===e.debug)return;if(e.debug.print&&(null==e.debug.data.value?console.log("debug.print, no data present yet."):console.log(e.debug.data.value)),!e.debug.show||!e.debug.data.value)return;const r=drawingContext instanceof WebGLRenderingContext,t=e.debug.data.value,o=`Device ${e.debug.data.id}`,a=40+20*t.length+20;e.debug.layer||(e.debug.layer=createGraphics(400,a),e.debug.layer.clear());const n=e.debug.layer;n.clear(),n.noStroke(),n.fill(0,40),n.rect(0,0,400,a,16),n.push(),n.translate(20,20),n.fill(255),n.text(o,0,0),n.translate(0,20),t.forEach(((e,r)=>{let t=constrain(e,0,1);n.push(),n.translate(0,20*r),n.fill(255,40),n.rect(0,0,300,10,4),n.fill(255,200),n.rect(0,2,300*t,8,4),n.fill(255),n.text(t.toFixed(2),320,10),n.pop()})),n.pop(),push(),r&&translate(-width/2,-height/2),translate(20,20),image(e.debug.layer,0,0),pop()})(v)))):console.error("p5.js not found. Please include p5.js before this library.");export{g as connect,y as getValueAt,w as getValues,f as isConnectionEstablished,b as isReadyToWrite,p as isValuesAvailable};
//# sourceMappingURL=p5.rxtx.es.min.js.map
